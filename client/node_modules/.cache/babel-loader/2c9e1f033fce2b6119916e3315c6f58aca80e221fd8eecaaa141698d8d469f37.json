{"ast":null,"code":"import{CCol,CCardBody,CCard,CButton,CFormSelect}from'@coreui/react';import{useState}from'react';import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";const Sobes=_ref=>{let{item,loadSobeses,specialists,loadSpecialists,spec}=_ref;const[selectedSpecialist,setSelectedSpecialist]=useState('');const[error,setError]=useState('');const abilitiesPercents=(arr1,arr2)=>{let count=0;for(let index=0;index<arr2.length;index++){const element=arr2[index];if(arr1.includes(element)){count=count+1;}}console.log(count,arr1.length);return count/arr1.length*100;};const deleteSobes=()=>{fetch(\"http://localhost:8080/api/sobes/\".concat(item.id),{method:'DELETE',headers:{'Content-Type':'application/json'}}).then(result=>{loadSobeses();});};const editSobes=()=>{fetch(\"http://localhost:8080/api/specialist/\".concat(selectedSpecialist),{method:'GET',headers:{'Content-Type':'application/json'}}).then(response=>{return response.json();}).then(data=>{if(abilitiesPercents(data.abilities.split(','),item.abilities.split(','))<80){setError('Недостаточно навыков');return;}else if(!(Number(data.time_start.split(':').join(''))<=Number(item.time_visit.split(':').join(''))&&Number(data.time_finish.split(':').join(''))>=Number(item.time_visit.split(':').join('')))){setError('Время визита не попадает во время приёма');return;}else{fetch(\"http://localhost:8080/api/specialist_sobeses/\".concat(selectedSpecialist),{method:'GET',headers:{'Content-Type':'application/json'}}).then(response=>{return response.json();}).then(data=>{if(!!data.find(el=>el.time_visit===item.time_visit)){setError('Время уже занято');return;}const sobes={id:item.id,fio:item.fio,time_visit:item.time_visit,abilities:item.abilities,specialist_id:selectedSpecialist};fetch(\"http://localhost:8080/api/sobes\",{method:'PUT',body:JSON.stringify(sobes),headers:{'Content-Type':'application/json'}}).then(result=>{loadSpecialists();});});}});};return/*#__PURE__*/_jsx(CCol,{xs:4,className:\"pb-3\",children:/*#__PURE__*/_jsx(CCard,{children:/*#__PURE__*/_jsxs(CCardBody,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u0424\\u0418\\u041E: \",item.fio]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u0412\\u0440\\u0435\\u043C\\u044F \\u0432\\u0438\\u0437\\u0438\\u0442\\u0430: \",item.time_visit]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u041D\\u0430\\u0432\\u044B\\u043A\\u0438: \",item.abilities]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(CFormSelect,{label:\"\\u041A\\u0443\\u0434\\u0430 \\u043F\\u0435\\u0440\\u0435\\u043D\\u0435\\u0441\\u0442\\u0438?\",onChange:e=>{setSelectedSpecialist(e.target.value);setError('');},children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\" \"}),specialists.filter(el=>el.id!==spec.id).map(specialist=>{return/*#__PURE__*/_jsx(\"option\",{value:specialist.id,children:specialist.fio},specialist.id);})]}),!!error&&/*#__PURE__*/_jsx(\"div\",{className:\"text-danger\",children:error}),/*#__PURE__*/_jsx(CButton,{className:\"mt-2 me-2\",size:\"sm\",onClick:()=>editSobes(),children:\"\\u041F\\u0435\\u0440\\u0435\\u043D\\u0435\\u0441\\u0442\\u0438\"}),/*#__PURE__*/_jsx(CButton,{className:\"mt-2\",size:\"sm\",color:\"danger\",onClick:()=>deleteSobes(),children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"})]})})});};export default Sobes;","map":{"version":3,"names":["CCol","CCardBody","CCard","CButton","CFormSelect","useState","jsxs","_jsxs","jsx","_jsx","Sobes","_ref","item","loadSobeses","specialists","loadSpecialists","spec","selectedSpecialist","setSelectedSpecialist","error","setError","abilitiesPercents","arr1","arr2","count","index","length","element","includes","console","log","deleteSobes","fetch","concat","id","method","headers","then","result","editSobes","response","json","data","abilities","split","Number","time_start","join","time_visit","time_finish","find","el","sobes","fio","specialist_id","body","JSON","stringify","xs","className","children","label","onChange","e","target","value","filter","map","specialist","size","onClick","color"],"sources":["/home/andrey/githubGokert/TRVP/client/src/Sobes.js"],"sourcesContent":["import { CCol, CCardBody, CCard, CButton, CFormSelect } from '@coreui/react';\nimport { useState } from 'react';\n\nconst Sobes = ({ item, loadSobeses, specialists, loadSpecialists, spec }) => {\n    const [selectedSpecialist, setSelectedSpecialist] = useState('');\n    const [error, setError] = useState('');\n\n    const abilitiesPercents = (arr1, arr2) => {\n        let count = 0;\n        for (let index = 0; index < arr2.length; index++) {\n            const element = arr2[index];\n            if (arr1.includes(element)) {\n                count = count + 1;\n            }\n        }\n        console.log(count, arr1.length);\n        return (count / arr1.length) * 100;\n    };\n\n    const deleteSobes = () => {\n        fetch(`http://localhost:8080/api/sobes/${item.id}`, {\n            method: 'DELETE',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n        }).then((result) => {\n            loadSobeses();\n        });\n    };\n\n    const editSobes = () => {\n        fetch(`http://localhost:8080/api/specialist/${selectedSpecialist}`, {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json',\n            },\n        })\n            .then((response) => {\n                return response.json();\n            })\n            .then((data) => {\n                if (abilitiesPercents(data.abilities.split(','), item.abilities.split(',')) < 80) {\n                    setError('Недостаточно навыков');\n                    return;\n                } else if (\n                    !(\n                        Number(data.time_start.split(':').join('')) <= Number(item.time_visit.split(':').join('')) &&\n                        Number(data.time_finish.split(':').join('')) >= Number(item.time_visit.split(':').join(''))\n                    )\n                ) {\n                    setError('Время визита не попадает во время приёма');\n                    return;\n                } else {\n                    fetch(`http://localhost:8080/api/specialist_sobeses/${selectedSpecialist}`, {\n                        method: 'GET',\n                        headers: {\n                            'Content-Type': 'application/json',\n                        },\n                    })\n                        .then((response) => {\n                            return response.json();\n                        })\n                        .then((data) => {\n                            if (!!data.find((el) => el.time_visit === item.time_visit)) {\n                                setError('Время уже занято');\n                                return;\n                            }\n                            const sobes = {\n                                id: item.id,\n                                fio: item.fio,\n                                time_visit: item.time_visit,\n                                abilities: item.abilities,\n                                specialist_id: selectedSpecialist,\n                            };\n                            fetch(`http://localhost:8080/api/sobes`, {\n                                method: 'PUT',\n                                body: JSON.stringify(sobes),\n                                headers: {\n                                    'Content-Type': 'application/json',\n                                },\n                            }).then((result) => {\n                                loadSpecialists();\n                            });\n                        });\n                }\n            });\n    };\n\n    return (\n        <CCol xs={4} className=\"pb-3\">\n            <CCard>\n                <CCardBody>\n                    <div>ФИО: {item.fio}</div>\n                    <div>Время визита: {item.time_visit}</div>\n                    <div>Навыки: {item.abilities}</div>\n                    <hr />\n                    <CFormSelect\n                        label=\"Куда перенести?\"\n                        onChange={(e) => {\n                            setSelectedSpecialist(e.target.value);\n                            setError('');\n                        }}>\n                        <option value=\"\"> </option>\n                        {specialists\n                            .filter((el) => el.id !== spec.id)\n                            .map((specialist) => {\n                                return (\n                                    <option key={specialist.id} value={specialist.id}>\n                                        {specialist.fio}\n                                    </option>\n                                );\n                            })}\n                    </CFormSelect>\n                    {!!error && <div className=\"text-danger\">{error}</div>}\n                    <CButton className=\"mt-2 me-2\" size=\"sm\" onClick={() => editSobes()}>\n                        Перенести\n                    </CButton>\n                    <CButton className=\"mt-2\" size=\"sm\" color=\"danger\" onClick={() => deleteSobes()}>\n                        Удалить\n                    </CButton>\n                </CCardBody>\n            </CCard>\n        </CCol>\n    );\n};\n\nexport default Sobes;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}